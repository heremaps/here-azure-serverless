{
    "handler": "Microsoft.Compute.MultiVm",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {}
        ],
        "steps": [
            {
            "name": "hereConfig",
            "label": "HERE Credentials",
            "subLabel": {
                "preValidation": "Configure HERE credentials",
                "postValidation": "Done"
            },
            "bladeTitle": "HERE Credentials",
            "elements": [
              {
                "name": "text1",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "Get your HERE App ID and App Code by Signing-up for FREE at https://developer.here.com",
                  "uri": "https://developer.here.com/ref/azure_marketplace_datastream?create=Freemium-Basic"
                }
              },
              
                {
                  "name": "hereAPP_ID",
                  "type": "Microsoft.Common.TextBox",
                  "label": "HERE App ID",
                  "toolTip" : "HERE App ID (https://developer.here.com/faqs#access-control)",
                  "visible": true,
                  "constraints": {
                    "required": true
                  }
                },
                {
                  "name": "hereAPP_CODE",
                  "type": "Microsoft.Common.TextBox",
                  "label": "HERE App Code",
                  "toolTip" : "HERE App Code (https://developer.here.com/faqs#access-control)",
                  "visible": true,
                  "constraints": {
                    "required": true
                  }
                }
            ]
        },
            {
                "name": "eventHubConfig",
                "label": "Event Hub settings",
                "subLabel": {
                    "preValidation": "Configure EventHub",
                    "postValidation": "Done"
                },
                "bladeTitle": "Event Hub settings",
                "elements": [
                    {
                        "name": "text3",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                          "text" : "Event Hub Namespace. A random string is pre-poulated, edit if required. Eventhub with name 'here_api_eventhub' will be provisioned automatically inside this namespace."
                        }
                      },
                    {
                        "name": "eventHubNamespaceName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Event Hub Namespace",
                        "defaultValue" : "[concat('eventhub', skip( replace( guid(),  '-', ''), 17)) ]",
                        "toolTip" : "Event Hub Namespace name.",
                        "visible": true,
                        "constraints": {
                          "required": true
                        }
                    }
                ]
            },
            {
                "name": "cosmosDBConfig",
                "label": "Cosmos DB settings",
                "subLabel": {
                    "preValidation": "Configure CosmosDB",
                    "postValidation": "Done"
                },
                "bladeTitle": "Cosmos DB settings",
                "elements": [
                    {
                        "name": "text4",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                          "text" : "Cosmos DB Account (SQL Api). A random string is pre-poulated, edit if required. This is required for storing result of API calls"
                        }
                      },
                    {
                        "name": "cosmosDBAccountName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "cosmos DB Account Name",
                        "defaultValue" : "[concat('cosmosdb', skip( replace( guid(),  '-', ''), 17)) ]",
                        "toolTip" : "Cosmos DB Account Name.",
                        "visible": true,
                        "constraints": {
                          "required": true
                        }
                    }
                ]
            },
            {
                "name": "storageConfig",
                "label": "Storage settings",
                "subLabel": {
                    "preValidation": "Configure the Storage",
                    "postValidation": "Done"
                },
                "bladeTitle": "Storage settings",
                "elements": [
                  {
                    "name": "text3",
                    "type": "Microsoft.Common.TextBlock",
                    "visible": true,
                    "options": {
                      "text" : "Storage account. A random string is pre-poulated, edit if required. Storage is required to keep code for functions, logs ,deployment details etc."
                    }
                  },
                  {
                      "name": "storageName",
                      "type": "Microsoft.Common.TextBox",
                      "label": "Storage Account Name",
                      "defaultValue" : "[concat('storage', skip( replace( guid(),  '-', ''), 17)) ]",
                      "toolTip" : "Provide a name for Storage Account, it will be validated upon submitting the request, an unique storage name is pre-populated",
                      "visible": true,
                      "constraints": {
                        "required": true
                      }
                  },
                  {
                      "name": "storageAccountType",
                      "type": "Microsoft.Common.DropDown",
                      "label": "Storage Account Type",
                      "defaultValue": "Standard_LRS",
                      "toolTip": "Choose a redundancy type ( local/zone/geo ) , Refer : https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy for more details.",
                      "constraints": {
                        "allowedValues": [
                          {
                            "label": "Standard_LRS",
                            "value": "Standard_LRS"
                          },
                          {
                            "label": "Standard_GRS",
                            "value": "Standard_GRS"
                          },
                          {
                            "label": "Standard_ZRS",
                            "value": "Standard_ZRS"
                          },
                          {
                            "label": "Premium_LRS",
                            "value": "Premium_LRS"
                          }
                        ],
                        "required": true
                      },
                      "visible": true
                    }
                ]
            },
            {
                "name": "functionAppConfig",
                "label": "Function App settings",
                "subLabel": {
                    "preValidation": "Configure the Function App Name",
                    "postValidation": "Done"
                },
                "bladeTitle": "Function App settings",
                "elements": [
                  {
                    "name": "text4",
                    "type": "Microsoft.Common.TextBlock",
                    "visible": true,
                    "options": {
                      "text" : "Globally unique function-app name. A random string is pre-poulated, edit if required."
                    }
                  },
                  {
                      "name": "functionAppName",
                      "type": "Microsoft.Common.TextBox",
                      "label": "Function App Name",
                      "defaultValue" : "[concat('fn-app', skip( replace( guid(),  '-', ''), 17)) ]",
                      "toolTip" : "Function App Name, it will be create as https://{{funcAppname}}.azurewebsites.net",
                      "visible": true,
                      "constraints": {
                        "required": true
                      }
                  }

                ]
            }

        ],
        "outputs": {
            "hereAPP_ID": "[steps('hereConfig').hereAPP_ID]",
            "hereAPP_CODE": "[steps('hereConfig').hereAPP_CODE]",

            "eventHubNamespaceName": "[steps('eventHubConfig').eventHubNamespaceName]",

            "cosmosDBAccountName": "[steps('cosmosDBConfig').cosmosDBAccountName]",

            "storageName": "[steps('storageConfig').storageName]",
            "storageAccountType": "[steps('storageConfig').storageAccountType]",
            
            "functionAppName": "[steps('functionAppConfig').functionAppName]"
        }
    }
}
